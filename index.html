<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>d3 Heatmap</title>

  <!-- load d3.js -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script> const div = d3.selectAll("div");</script>
</head>

<body>

  <!-- upload csv file -->
  <input id="input" type="file" accept=".csv">

  <div id="buttons"></div> <br>

  <!-- graph will take place here -->
  <div id="graph"></div>

  <script>
    // set the dimensions and margins of the graph
    var margin = { top: 30, right: 30, bottom: 30, left: 30 },
      width = 450 - margin.left - margin.right,
      height = 450 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#graph")
      .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

    //handle input csv file
    var input = document.getElementById("input");
    input.onchange = function () {
      var fileList = input.files;

      //file read as text
      var reader = new FileReader();
      reader.readAsText(fileList[0]);

      //after file loaded
      var data;
      reader.onload = function () {
        data = d3.csvParse(reader.result, d3.autoType);

        //make buttons to select graph option
        var buttons = document.getElementById("buttons");

        //draw xz graph
        var option1 = document.createElement("button");
        option1.innerHTML = "XZ";
        option1.addEventListener("click", () => {
          drawGraph();
        })
        buttons.appendChild(option1);

        var option2 = document.createElement("button");
        option2.innerHTML = "YZ";
        option2.addEventListener("click", () => {
          drawGraph();
        })
        buttons.appendChild(option2);

        var option3 = document.createElement("button");
        option3.innerHTML = "heatmap";
        option3.addEventListener("click", () => {
          drawGraph();
        })
        buttons.appendChild(option3);
      };



      function drawGraph() {
        // Build X scales and axis:
        var x = d3.scaleBand()
          .range([0, width])
          .domain(data.map(d => d.x))
          .padding(0.01);

        svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        // Build Y scales and axis:
        var y = d3.scaleBand()
          .range([height, 0])
          .domain(data.map(d => d.y))
          .padding(0.01);

        svg.append("g")
          .call(d3.axisLeft(y));

        // Build color scale
        var myColor = d3.scaleLinear()
          .range(["white", "#69b3a2"])
          .domain([1, 100])

        svg.selectAll()
          .data(data, function (d) { return d.group + ':' + d.variable; })
          .enter()
          .append("rect")
          .attr("x", function (d) { return x(d.group) })
          .attr("y", function (d) { return y(d.variable) })
          .attr("width", x.bandwidth())
          .attr("height", y.bandwidth())
          .style("fill", function (d) { return myColor(d.value) })
      };
    }
  </script>

</body>

</html>